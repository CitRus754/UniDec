----------------------------------------------------------------------------------
-- Company: 		NTT
-- Engineer: 		Citaishvili R.A.
-- 
-- Create Date: 	26.09.2023 12:43:27
-- Design Name: 	UniDec
-- Module Name: 	testbench - Behavioral
-- Project Name: 	UniDec
-- Target Devices:	
-- Tool Versions: 	
-- Description: 	
-- 
-- Dependencies: 
-- 
-- Revision:
-- Revision 0.01 - File Created
-- Additional Comments:
-- 
----------------------------------------------------------------------------------


library IEEE;
use IEEE.std_logic_1164.all;
use IEEE.std_logic_arith.ALL;
library STD;
use STD.textio.all;
use STD.env.finish;

entity DDS_TB is
--  Port ( );
end DDS_TB;

architecture Behavioral of DDS_TB is

    component dds_compiler_1 is
		PORT (
			aclk : IN STD_LOGIC;
			s_axis_phase_tvalid : IN STD_LOGIC;
			s_axis_phase_tdata : IN STD_LOGIC_VECTOR(23 DOWNTO 0);
			s_axis_phase_tlast : IN STD_LOGIC;
			m_axis_data_tvalid : OUT STD_LOGIC;
			m_axis_data_tdata : OUT STD_LOGIC_VECTOR(31 DOWNTO 0);
			event_s_phase_tlast_missing : OUT STD_LOGIC;
			event_s_phase_tlast_unexpected : OUT STD_LOGIC
		);
	end component;
	
	constant PERIOD			: time := 11.363636364 ns;        -- Fclk = 88 MHz	
	signal Clk				: std_logic;
	
	signal In_TVALID		: std_logic := '1';
	signal FCW				: std_logic_vector(23 downto 0) := (others => '0');
	signal In_TLAST			: std_logic := '0';	
	signal Out_TVALID		: std_logic := '0';
	signal Missing			: std_logic := '0';
	signal Unexp			: std_logic := '0';
	
	signal DDS_Out			: std_logic_vector(31 downto 0);
	signal Out_Cos			: std_logic_vector(11 downto 0);
	signal Out_Sin			: std_logic_vector(11 downto 0);	

begin

	gen_clk: process begin
		loop
			Clk <= '0';
			wait for PERIOD/2;
			Clk <= '1';
			wait for PERIOD/2;
		end loop;
	end process;
	
	gen_input: process begin
		FCW <= x"1d1746";		-- 5 MHz
		wait;
	end process;
	
	gen_tlast: process(Clk) begin
		if rising_edge(Clk) then
			In_TLAST <= not In_TLAST;
		end if;
	end process;
	
	DDS: dds_compiler_1
	port map (	aclk 							=> Clk,
				s_axis_phase_tvalid 			=> In_TVALID,
				s_axis_phase_tdata 				=> FCW,
				s_axis_phase_tlast				=> In_TLAST,
				m_axis_data_tvalid 				=> Out_TVALID,
				m_axis_data_tdata 				=> DDS_Out,
				event_s_phase_tlast_missing		=> ,
				event_s_phase_tlast_unexpected	=> 
			);
	
	Out_Cos <= DDS_Out(11 downto 0);
	Out_Sin <= DDS_Out(27 downto 16);
		
end Behavioral;
